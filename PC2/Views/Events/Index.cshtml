@model PC2.Models.EventsModel
@{
    if (Model.IsPC2EventCalendar)
    {
        ViewData["Title"] = "PC2 Events and Activities";
    }
    else
    {
        ViewData["Title"] = "County-wide Events and Activities";
    }

    List<List<CalendarEvent>> eventDateGroups = 
            Model.CalendarEvents
            .GroupBy(calEvent => calEvent.DateOfEvent)
            .Select(group => group.OrderByDescending(x => x.StartingTime).ToList())
            .OrderByDescending(group => group.First())
            .ToList();
}

<div class="d-flex justify-content-center">
    <img src=~/images/events/events1.jpg />
    <img src=~/images/events/events2.jpg />
    <img src=~/images/events/events3.jpg />
    <img src=~/images/events/events4.jpg />
</div>
<br />
<h1>@ViewData["Title"]</h1>

<div class="divider"></div>

<br />


@section Head{
    <style>
        .agenda .agenda-date {
            width: 170px;
        }

        .agenda .agenda-date .dayofmonth {
            width: 40px !important;
            font-size: 36px !important;
            line-height: 36px !important;
            float: left;
            text-align: right;
            margin-right: 10px;
        }

        .agenda .agenda-date .shortdate {
            font-size: 0.75em;
        }


        /* Times */
        .agenda .agenda-time {
            width: 140px;
        }
    </style>
}

@if (Model.IsPC2EventCalendar)
{
    <p>
        <a asp-action="Index" asp-route-eventType="County">View County-Wide Events</a>
    </p>
}
else
{
    <p>
        <a asp-action="Index">View PC2 Events</a>
    </p>
}
<br />

@if (Model.CalendarEvents.Count > 0)
{
    <div class="agenda">
        <div class="table-responsive">
            <table class="table table-condensed table-bordered">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Event</th>
                    </tr>
                </thead>
                <tbody>

                    @for (int currentDate = 0; currentDate < eventDateGroups.Count; currentDate++)
                    {
                        <tr>
                            <td class="agenda-date" class="active" rowspan="@eventDateGroups[currentDate].Count">
                                <div class="dayofmonth">@eventDateGroups[currentDate][0].DateOfEvent.Day</div>
                                <div class="dayofweek">@eventDateGroups[currentDate][0].DateOfEvent.DayOfWeek</div>
                                <div class="shortdate text-muted">@eventDateGroups[currentDate][0].DateOfEvent.ToString("MMMM"),&nbsp;@eventDateGroups[currentDate][0].DateOfEvent.Year</div>
                            </td>

                            @for (int currentEvent = 0; currentEvent < eventDateGroups[currentDate].Count; currentEvent++)
                            {
                                @if (currentEvent > 0) // Create a whole row after the first event of each day
                                {
                                    <tr>
                                        <td class="agenda-time">
                                            @eventDateGroups[currentDate][currentEvent].StartingTime &nbsp;-&nbsp; @eventDateGroups[currentDate][currentEvent].EndingTime
                                        </td>
                                        <td class="agenda-events">
                                            <div class="agenda-event">
                                                @eventDateGroups[currentDate][currentEvent].EventDescription
                                            </div>
                                        </td>
                                    </tr>
                                }
                                else
                                {
                                    <td class="agenda-time">
                                        @eventDateGroups[currentDate][currentEvent].StartingTime &nbsp;-&nbsp; @eventDateGroups[currentDate][currentEvent].EndingTime
                                    </td>
                                    <td class="agenda-events">
                                        <div class="agenda-event">
                                            @eventDateGroups[currentDate][currentEvent].EventDescription
                                        </div>
                                    </td>
                                }
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <h2>There are no upcoming @ViewData["Title"] on the Calendar</h2>
    <br />
}

<div class="text-center">
    <img class="img-fluid" height="600" src="~/images/events/June2022-NewEventActivityFlyer.jpg" alt="June 2022 New Activity Event Flyer">
</div>