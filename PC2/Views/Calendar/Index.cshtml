@model List<PC2.Controllers.CalendarDisplayEventViewModel>
@{
    ViewData["Title"] = "Event Calendar";
}

<style>
    .agenda .agenda-date {
        width: 170px;
    }

        .agenda .agenda-date .dayofmonth {
            width: 40px !important;
            font-size: 36px !important;
            line-height: 36px !important;
            float: left;
            text-align: right;
            margin-right: 10px;
        }

        .agenda .agenda-date .shortdate {
            font-size: 0.75em;
        }


    /* Times */
    .agenda .agenda-time {
        width: 140px;
    }


    /* Events */
    .agenda .agenda-events {
    }

        .agenda .agenda-events .agenda-event {
        }

    @@media (max-width: 767px) {
    }
</style>

<h1>@ViewData["Title"]</h1>

@if (TempData["UpdateFailed"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["UpdateFailed"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
        </button>
    </div>
}

@if (TempData["EventDeleted"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        Event was deleted successfully!
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
        </button>
    </div>
}

<div class="agenda">
    <div class="table-responsive">
        <table class="table table-condensed table-bordered">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Event</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Count; i++)
                {
                    <tr>
                        <td class="agenda-date" class="active" rowspan="@Model[i].EventsForDate.Count">
                            <div class="dayofmonth">@Model[i].DateOfEvent.Day</div>
                            <div class="dayofweek">@Model[i].DateOfEvent.DayOfWeek</div>
                            <div class="shortdate text-muted">@Model[i].DateOfEvent.ToString("MMMM"),&nbsp;@Model[i].DateOfEvent.Year</div>
                        </td>
                        @for (int j = 0; j < Model[i].EventsForDate.Count; j++)
                        {
                            var currentEvent = Model[i].EventsForDate[j];
                            @if (j > 0)
                            {
                                <tr>
                                    <td class="agenda-time">
                                        @currentEvent.StartingTime &nbsp;-&nbsp; @currentEvent.EndingTime
                                    </td>
                                    <td class="agenda-events">
                                        <div class="agenda-event">
                                            @currentEvent.Description
                                        </div>
                                    </td>
                                    <td>
                                        <a asp-action="Edit" asp-route-id="@currentEvent.EventId">Edit Event</a> |
                                        <a asp-action="Delete" onclick="confirmEventDeletion();" asp-route-id="@currentEvent.EventId">Delete Event</a>
                                    </td>
                                </tr>
                            }
                            else
                            {
                                <td class="agenda-time">
                                    @currentEvent.StartingTime &nbsp;-&nbsp; @currentEvent.EndingTime
                                </td>
                                <td class="agenda-events">
                                    <div class="agenda-event">
                                        @currentEvent.Description
                                    </div>
                                </td>
                                <td>
                                    <a asp-action="Edit" asp-route-id="@currentEvent.EventId">Edit Event</a> |
                                    <a asp-action="Delete" onclick="confirmEventDeletion();" asp-route-id="@currentEvent.EventId">Delete Event</a>
                                </td>
                            }
                        }
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts{
    <script>
        function confirmEventDeletion() {
            let userConfirmed = confirm("Are you sure you want to delete this event?");
            if (!userConfirmed) {
                event.preventDefault();
            }
        }
    </script>
}